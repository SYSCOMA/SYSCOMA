<%= form_for @search_criteria, { url: search_criteria_path, method: :post } do |f| %>
  
  <% if @search_criteria.errors.any? %>
    <div id="error_expl" class="panel panel-danger">
      <div class="panel-heading">
        <h3 class="panel-title"><%= pluralize(@search_criteria.errors.count, "error") %> prohibited this search criteria from being saved:</h3>
      </div>
      <div class="panel-body">
        <ul>
        <% @search_criteria.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <%= f.hidden_field :scope_id %>
  <%= hidden_field_tag :save, @save %>

  <% if @save %>
    <dl class="dl-horizontal">
      <dt><strong><%= f.label "Search name for saving" %></strong></dt>
      <dd><%= f.text_field :name %></dd>
      <%= error_span(@search_criteria[:name]) %>
    </dl>
  <% end %>

  <% if @search_criteria.composition.present? %>
    <dl class="dl-horizontal">
      <dt><strong><%= f.label "Conective" %></strong></dt>
      <dd><%= select_tag :conective, options_for_select(conectives) %></dd>
    </dl>
  <% end %>

  <dl class="dl-horizontal">
    <dt><strong><%= f.label "Competence matrix" %></strong></dt>
    <% if @competence_matrix.present? %>
      <dd><%= @competence_matrix.name %></dd>
      <%= hidden_field_tag :competence_matrix_id, @competence_matrix.id %>

      </dl>
      <dl class="dl-horizontal">
        <dt><strong><%= f.label "Knowledge Area" %></strong></dt>
        <% if @knowledge_area.present? %>
          <dd><%= @knowledge_area.name %></dd>
          <%= hidden_field_tag :knowledge_area_id, @knowledge_area.id %>
        <% else %>
          <dd><%= select_tag :knowledge_area_id, options_from_collection_for_select(@knowledge_areas, :id, :name) %></dd>
        <% end %>
      </dl>

      <dl class="dl-horizontal">
        <dt><strong><%= f.label "Ability" %></strong></dt>
        <% if @ability.present? %>
          <dd><%= @ability.name %></dd>
          <%= hidden_field_tag :ability_id, @ability.id %>
        <% else %>
          <dd><%= select_tag :ability_id, options_from_collection_for_select(@abilities, :id, :name) %></dd>
        <% end %>
      </dl>

      <dl class="dl-horizontal">
        <dt><strong><%= f.label "Operation" %></strong></dt>
        <% if @sign.present? %>
          <dd><%= @sign %></dd>
          <%= hidden_field_tag :sign, @sign %>
        <% else %>
          <dd><%= select_tag :sign, options_for_select(signs) %></dd>
        <% end %>

      <% if @ability.present? %>
        </dl>
        <dl class="dl-horizontal">
          <dt><strong><%= f.label "Competence value" %></strong></dt>
          <dd><%= select_tag :value_id, options_from_collection_for_select(@values.to_a, :id, :value) %></dd>
      <% end %>
    <% else %>
      <dd><%= select_tag :competence_matrix_id, options_from_collection_for_select(@competence_matrices, :id, :name) %></dd>
    <% end %>
  </dl>
  <%= f.submit "Compose", class: 'btn btn-primary' %>

  <dl class="dl-horizontal">

    <dt><strong><%= f.label "Advanced search" %></strong></dt>
    <dd><%= f.text_area :composition %></dd>
    <%= error_span(@search_criteria[:composition]) %>
  </dl>


  <%= f.submit "Search", class: 'btn btn-primary' %>
  <%= link_to t('.back', :default => t("helpers.links.back")),
            :back, :class => 'btn btn-default' %>
<% end %>